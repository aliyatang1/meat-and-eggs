{% extends "layout.html" %}

{% block content %}
<div class="quiz-container">
    <div class="progress">Question <span id="current-q">{{ question_id }}</span> of {{ total_questions }}</div>
    <div class="question-box">
        <div class="question" id="question-text">{{ question.question }}</div>
    </div>
    <div class="options" id="options-container">
        {% for option in question.options %}
            <button class="option-btn" onclick="checkAnswer('{{ option }}')">{{ option }}</button>
        {% endfor %}
    </div>
    <div class="feedback" id="feedback"></div>
    <form method="GET" action="/quiz/{{ topic }}/{{ question_id + 1 }}">
        <button id="next-btn" class="next-btn" type="submit" style="display: none;">Next â†’</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<style>
    .quiz-container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .question-box {
        border: 2px solid #007BFF;
        border-radius: 6px;
        padding: 15px;
        margin: 20px 0;
        background-color: #e9f2ff;
    }
    .question {
        font-size: 1.2em;
        font-weight: bold;
    }
    .options {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .option-btn {
        padding: 10px 15px;
        background-color: #f0f0f0;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        text-align: left;
        transition: background-color 0.3s;
    }
    .option-btn:hover {
        background-color: #e0e0e0;
    }
    .feedback {
        margin-top: 15px;
        padding: 10px;
        border-radius: 4px;
        display: none;
    }
    .correct {
        background-color: #d4edda;
        color: #155724;
    }
    .incorrect {
        background-color: #f8d7da;
        color: #721c24;
    }
    .next-btn {
        margin-top: 20px;
        background-color: #007BFF;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        font-size: 1em;
        cursor: pointer;
    }
    .next-btn:hover {
        background-color: #0056b3;
    }
</style>

<script>
    const topic = "{{ topic }}";
    const questionId = {{ question_id }};
    const correctAnswer = "{{ question.correct_answer }}";

    function checkAnswer(selectedOption) {
        const feedbackDiv = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');

        if (selectedOption === correctAnswer) {
            feedbackDiv.textContent = "Correct!";
            feedbackDiv.className = 'feedback correct';
        } else {
            feedbackDiv.textContent = `Incorrect. The correct answer is: ${correctAnswer}`;
            feedbackDiv.className = 'feedback incorrect';
        }

        feedbackDiv.style.display = 'block';
        nextBtn.style.display = 'inline-block';

        fetch('/submit_answer', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                topic: topic,
                question_id: questionId,
                answer: selectedOption,
                correct: selectedOption === correctAnswer
            })
        });
    }
</script>
{% endblock %}
